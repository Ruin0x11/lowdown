<div id="page-header">
  <h1>Multnomah County ADS Report</h1>
</div>

<h2><%= describe_date_range(@query.start_date, @query.end_date) %></h2>

<table id="active-rider-results" class="results">
  <thead>
    <tr>
      <th>Customer</th>
      <th>Service Date</th>
      <th>Start Time</th>
      <th>Pickup Address</th>
      <th>Drop Off Address</th>
      <th>District Center</th>
      <th>Partner Cost</th>
      <th>Taxi Cost</th>
      <th>Scheduling Fee</th>
      <th>Total Cost</th>
      <th>Provider</th>
    </tr>
  </thead>
  <tbody>
    <% @run_groups.keys.sort{|a,b| a.start_at <=> b.start_at}.each do |run| %>
      <tr>
        <td>Hourly Trip</td>
        <td><%= run.date.to_s(:mdy) %></td>
        <td><%= run.start_at.to_s(:time_only) %></td>
        <td><%= run.ads_billable_hours %> billable hours</td>
        <td></td>
        <td></td>
        <td class="number"><%= number_to_currency(run.ads_partner_cost) %></td>
        <td></td>
        <td class="number"><%= number_to_currency(run.ads_scheduling_fee) %></td>
        <td class="number"><%= number_to_currency(run.ads_total_cost) %></td>
        <td><%= run.trips.first.allocation.provider.name %></td>
      </tr>
      <% @run_groups[run].each do |t| %>
        <tr>
          <td><%= t.customer.name %></td>
          <td><%= t.date.to_s(:mdy) %></td>
          <td><%= t.start_at.to_s(:time_only) %></td>
          <td><%= t.pickup_address.full_address %></td>
          <td><%= t.dropoff_address.full_address %></td>
          <td><%= t.case_manager_office %></td>
          <td class="number"><%= number_to_currency(t.ads_partner_cost) %></td>
          <td class="number"><%= number_to_currency(t.ads_taxi_cost) %></td>
          <td class="number"><%= number_to_currency(t.ads_scheduling_fee) %></td>
          <td class="number"><%= number_to_currency(t.ads_total_cost) %></td>
          <td><%= t.allocation.provider.name %></td>
        </tr>
      <% end %>
    <% end %>
    <% @trips_billed_per_trip.sort{|a,b| a.customer.name <=> b.customer.name}.each do |t| %>
      <tr>
        <td><%= t.customer.name %></td>
        <td><%= t.date.to_s(:mdy) %></td>
        <td><%= t.start_at.to_s(:time_only) %></td>
        <td><%= t.pickup_address.full_address %> </td>
        <td><%= t.dropoff_address.full_address %> </td>
        <td><%= t.case_manager_office %></td>
        <td class="number"><%= number_to_currency(t.ads_partner_cost) %></td>
        <td class="number"><%= number_to_currency(t.ads_taxi_cost) %></td>
        <td class="number"><%= number_to_currency(t.ads_scheduling_fee) %></td>
        <td class="number"><%= number_to_currency(t.ads_total_cost) %></td>
        <td><%= t.allocation.provider.name %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="6"></td>
      <td class="number"><%= number_to_currency(@total_partner_cost) %></td>
      <td class="number"><%= number_to_currency(@total_taxi_cost) %></td>
      <td class="number"><%= number_to_currency(@total_scheduling_fee) %></td>
      <td class="number"><%= number_to_currency(@total_cost) %></td>
      <td></td>
    </tr>
    <tr>
      <td>Total Billable Hours</td>
      <td class="number"><%= @total_billable_hours %></td>
    </tr>
    <tr>
      <td>&nbsp;&nbsp;&nbsp;Hourly Trips</td>
      <td class="number"><%= @per_hour_trip_count %></td>
    </tr>
    <tr>
      <td>&nbsp;&nbsp;&nbsp;Taxi Trips</td>
      <td class="number"><%= @taxi_trip_count %></td>
    </tr>
    <tr>
      <td>&nbsp;&nbsp;&nbsp;Partner Trips</td>
      <td class="number"><%= @partner_trip_count %></td>
    </tr>
    <tr>
      <td>Total Trip Count</td>
      <td class="number"><%= @per_hour_trip_count + @taxi_trip_count + @partner_trip_count %></td>
    </tr>
  </tfoot>
</table>

