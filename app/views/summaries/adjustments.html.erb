<div id="page-header">
  <h1>Summary Adjustment History</h1>
</div>
<%= form_for @query, :as => :q, :html=>{:id=>"summary-filter", :method=>:get}, :url=>{:action=>:adjustments} do |f| %>
  <fieldset>

    <ol class="section first">
      <li>
        <label>Start Date:</label>
        <%= f.date_select( :start_date, :start_year => 2012, :end_year => Date.today.year, :order => [:month, :year] ) %>
      </li>
      <li>
        <label>End Date:</label>
        <%= f.date_select( :end_date, :start_year => 2012, :end_year => Date.today.year, :order => [:month, :year] ) %>
      </li>
    </ol>

    <ol class="section fourth">
      <li>
        <label>Reporting Agencies:</label>
        <%= f.collection_select :reporting_agency, @query.reporting_agencies, :id, :to_s, :include_blank => true %>
      </li>
      <li>
        <label>Providers:</label>
        <%= f.collection_select :provider, @query.providers, :id, :to_s, :include_blank => true %>
      </li>
      <li>
        <label>Adjustment notes contain:</label>
        <%= f.text_field :adjustment_notes_contain %>
      </li>
    </ol>

    <div class="actions">
      <input id="summary-search" type="submit" value="Search" />
    </div>

  </fieldset>
<% end %> 

<div class="list-wrapper">
  <table id="summary-results">
    <thead>
      <tr>
       <th rowspan="2">Change Date & Time</th>
       <th rowspan="2">Allocation</th>
       <th rowspan="2">Month</th>
       <th colspan="9" class="column-group">Change Only</th>
       <th rowspan="2">Adjustment Notes</th>
       <th rowspan="2">&nbsp;</th>
      </tr>
      <tr>
       <th class="number">Total Cost</th>
       <th class="number">In</th>
       <th class="number">Out</th>
       <th class="number">Total Trips</th>
       <th class="number">Miles</th>
       <th class="number">Pd Hours</th>
       <th class="number">Vol Hours</th>
       <th class="number">Total Driver Hours</th>
       <th class="number">Undup</th>
      </tr>
    </thead>
    <tbody>
      <% @summaries.each do |summary| %>
        <tr>
          <td>
            <%= summary.valid_start.in_time_zone("Pacific Time (US & Canada)").strftime('%D %I:%M %p') %>
          </td>
          <td><%= summary.allocation.name %></td>
          <td><%= summary.period_start.strftime("%b %Y") %></td>
          <td class="number"><%= number_to_currency(attribute_difference(summary, :total_cost)) %></td>
          <td class="number"><%= attribute_difference(summary, :in_district_trips)  %></td>
          <td class="number"><%= attribute_difference(summary, :out_of_district_trips) %></td>
          <td class="number"><%= attribute_difference(summary, :trips) %></td>
          <td class="number"><%= attribute_difference(summary, :total_miles) %></td>
          <td class="number"><%= attribute_difference(summary, :driver_hours_paid) %></td>
          <td class="number"><%= attribute_difference(summary, :driver_hours_volunteer) %></td>
          <td class="number"><%= attribute_difference(summary, :total_driver_hours) %></td>
          <td class="number"><%= attribute_difference(summary, :unduplicated_riders) %></td>
          <td><%= summary.adjustment_notes %></td>
          <td><%= link_to 'Details', :action=>:edit, :id=>summary.id %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<%= will_paginate @summaries %>
